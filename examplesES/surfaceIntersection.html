<!DOCTYPE html>
<html>

<head>
  <title>Surface-Surface Intersection</title>

  <script async src="https://ga.jspm.io/npm:es-module-shims@2.0.10/dist/es-module-shims.js"></script>

  <script type="importmap">
    {
      "imports": {
        "three": "https://unpkg.com/three/build/three.module.js",
        "three/addons/": "https://unpkg.com/three/examples/jsm/",
        "verb": "https://unpkg.com/verb-nurbs@3.0.2/build/js/verb.es.js",
        "web-worker": "https://unpkg.com/web-worker@1.3.0/browser.js",
        "tessellate": "./js/tessellateThree.js",
        "scene": "./js/sceneThree.js",
        "codeViewer": "./js/codeViewer.js"
      }
    }
  </script>

  <link rel="stylesheet" href="https://unpkg.com/@highlightjs/cdn-assets/styles/atom-one-dark.min.css">
  <script src="https://unpkg.com/@highlightjs/cdn-assets/highlight.min.js"></script>

  <link rel="stylesheet" href="css/example.css">
</head>

<body>
  <div id="viewer">
    <div id="title"></div>
  </div>

<script type="module" id="script">
import verb from 'verb'
import { tessellateCurve, tessellateSurface } from 'tessellate'
import { Scene } from 'scene'

const scene = new Scene()

function exNurbsSurfacePlane(){
  let degree = 3
  let knots = [0, 0, 0, 0, 0.333, 0.666, 1, 1, 1, 1]
  let pts = [
    [ [0, 0, -10], [10, 0, 0], [20, 0, 0], [30, 0, 0] , [40, 0, 0], [50, 0, 9] ],
    [ [0, -10, 0], [10, -10, 10], [20, -10, 10], [30, -10, 0] , [40, -10, 0], [50, -10, 0]],
    [ [0, -20, 0], [10, -20, 10], [20, -20, 10], [30, -20, 0] , [40, -20, -2], [50, -20, 0] ],
    [ [0, -30, 0], [10, -30, 0], [20, -30, 0], [30, -30, 0] , [40, -30, 0], [50, -30, 0]     ],
    [ [0, -40, 0], [10, -40, 0], [20, -40, 0], [30, -40, 4] , [40, -40, -20], [50, -40, 0]     ],
    [ [0, -50, 12], [10, -50, 0], [20, -50, 0], [30, -50, 0] , [50, -50, 0], [50, -50, 15]     ],
  ]

  const srf1 = new verb.geom.NurbsSurface.byKnotsControlPointsWeights( degree, degree, knots, knots, pts )

  let p5 = [50,-50,3]
  let p6 = [50,0,3]
  let p7 = [0,0,3]
  let p8 = [0,-50,5]

  const srf2 = verb.geom.NurbsSurface.byCorners( p5, p6, p7, p8 )

  return { srf1, srf2 }
}

const { srf1, srf2 } = exNurbsSurfacePlane()
    
scene.addSurface( tessellateSurface( srf1 ), null, false )
scene.addSurface( tessellateSurface( srf2 ), null, false )

let results
let runs = 1

let d1 = Date.now()

for (let i = 0 ; i < runs; i++){
  results = verb.geom.Intersect.surfaces( srf1, srf2, 1e-6 )
}

let d2 = Date.now()

console.log( "intersected in ", (d2 - d1) / runs, " ms and " + results.length + " curves were discovered")

for (let i = 0; i < results.length; i++){
  scene.addCurve( tessellateCurve( results[i] ) )
}

scene.render()
</script>

<div id="button">Show/Hide Code</div>
<pre><code id="code-container" class="language-javascript"></code></pre>

<script type='module'>
import { setupViewer } from 'codeViewer'

setupViewer()

hljs.highlightAll()
</script>

</body>

</html>
